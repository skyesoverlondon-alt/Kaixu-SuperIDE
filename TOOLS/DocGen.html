<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Doc Gen ‚Äî kAIxU</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<style>
:root{--bg0:#040008;--bg1:#0d001a;--bg2:#16002e;--bg3:#1e003f;--purple:#a243ff;--purple-hot:#d130ff;--gold:#ffd36a;--cyan:#30e0ff;--green:#4fffb0;--red:#ff4f6a;--orange:#ff9f43;--fg:#e8e0f0;--fgd:#9988bb}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg0);color:var(--fg);font-family:'Inter',sans-serif;height:100vh;display:flex;flex-direction:column;overflow:hidden}
header{background:var(--bg1);border-bottom:1px solid #2a0050;padding:10px 20px;display:flex;align-items:center;gap:14px;flex-shrink:0}
header h1{font-size:1.1rem;color:var(--purple-hot);font-family:'Share Tech Mono',monospace}
header span{color:var(--fgd);font-size:.8rem}
.btn{padding:6px 14px;border-radius:7px;border:none;font-size:.8rem;cursor:pointer;font-weight:600;transition:.2s}
.btn-purple{background:var(--purple);color:#fff}.btn-purple:hover{background:var(--purple-hot)}
.btn-green{background:var(--green);color:#040008}.btn-green:hover{opacity:.85}
.btn-cyan{background:var(--cyan);color:#040008}.btn-cyan:hover{opacity:.85}
.btn-gold{background:var(--gold);color:#040008}.btn-gold:hover{opacity:.85}
.btn-outline{background:transparent;color:var(--fgd);border:1px solid #3a0066}.btn-outline:hover{border-color:var(--purple);color:var(--purple)}
.btn-red{background:var(--red);color:#fff}.btn-red:hover{opacity:.85}
main{display:flex;flex:1;overflow:hidden}
/* Left controls */
.left-panel{width:280px;background:var(--bg1);border-right:1px solid #1a0030;display:flex;flex-direction:column;overflow-y:auto;flex-shrink:0}
.section{border-bottom:1px solid #1a0030;padding:14px}
.section-title{font-size:.72rem;font-weight:700;color:var(--gold);text-transform:uppercase;letter-spacing:.08em;margin-bottom:10px}
.gen-btn-row{display:flex;flex-direction:column;gap:6px}
.gen-btn{width:100%;padding:9px 12px;border-radius:8px;border:1px solid #3a0066;background:var(--bg2);color:var(--fg);font-size:.82rem;cursor:pointer;text-align:left;transition:.2s;display:flex;align-items:center;gap:8px}
.gen-btn:hover{border-color:var(--purple);background:var(--bg3)}
.gen-btn .badge{margin-left:auto;font-size:.65rem;padding:2px 6px;border-radius:8px;background:var(--bg3)}
.gen-btn.running{border-color:var(--cyan);animation:pulse .8s infinite alternate}
@keyframes pulse{to{border-color:var(--purple-hot)}}
.form-group{margin-bottom:10px}
.form-label{font-size:.72rem;color:var(--fgd);margin-bottom:4px;display:block}
.form-input{width:100%;background:var(--bg2);border:1px solid #3a0066;border-radius:6px;padding:7px 9px;color:var(--fg);font-size:.8rem;outline:none}
.form-input:focus{border-color:var(--purple)}
.check-row{display:flex;align-items:center;gap:8px;font-size:.78rem;color:var(--fg);margin-bottom:6px}
.check-row input{accent-color:var(--purple)}
/* Center ‚Äî tabs + preview */
.center-pane{flex:1;display:flex;flex-direction:column;overflow:hidden}
.tabs{display:flex;background:var(--bg1);border-bottom:1px solid #1a0030;flex-shrink:0}
.tab{padding:9px 18px;font-size:.78rem;cursor:pointer;color:var(--fgd);border-bottom:2px solid transparent;transition:.2s}
.tab.active{color:var(--purple);border-bottom-color:var(--purple)}
.tab-body{flex:1;overflow:hidden;display:none}
.tab-body.active{display:flex}
.preview-area{flex:1;padding:20px;overflow-y:auto;font-family:'Inter',sans-serif;font-size:.88rem;line-height:1.7}
.preview-area h1{color:var(--gold);font-size:1.4rem;border-bottom:1px solid #2a0050;padding-bottom:8px;margin-bottom:14px}
.preview-area h2{color:var(--purple-hot);font-size:1.05rem;margin:20px 0 8px}
.preview-area h3{color:var(--cyan);font-size:.9rem;margin:14px 0 6px}
.preview-area p{color:var(--fg);margin-bottom:10px}
.preview-area code{background:var(--bg2);padding:1px 5px;border-radius:3px;font-family:'Share Tech Mono',monospace;font-size:.78rem;color:var(--cyan)}
.preview-area pre{background:var(--bg1);border:1px solid #2a0050;border-radius:8px;padding:12px;overflow-x:auto;margin:10px 0}
.preview-area pre code{background:none;color:var(--green);padding:0}
.preview-area table{width:100%;border-collapse:collapse;margin:10px 0;font-size:.8rem}
.preview-area th{background:var(--bg2);padding:6px 10px;text-align:left;color:var(--gold)}
.preview-area td{padding:6px 10px;border-bottom:1px solid #1a0030;color:var(--fgd)}
.raw-area{flex:1;padding:0;overflow:hidden;display:flex;flex-direction:column}
.raw-area textarea{flex:1;background:var(--bg1);border:none;padding:16px;color:var(--green);font-family:'Share Tech Mono',monospace;font-size:.8rem;resize:none;outline:none}
/* Right log */
.right-panel{width:240px;background:var(--bg1);border-left:1px solid #1a0030;display:flex;flex-direction:column;flex-shrink:0}
.rp-title{padding:10px 12px;font-size:.72rem;font-weight:700;color:var(--gold);text-transform:uppercase;border-bottom:1px solid #1a0030}
.log-stream{flex:1;overflow-y:auto;padding:10px;font-family:'Share Tech Mono',monospace;font-size:.72rem}
.log-line{padding:2px 0;border-bottom:1px solid #08001a}
.log-line.ok{color:var(--green)}
.log-line.info{color:var(--cyan)}
.log-line.warn{color:var(--gold)}
.log-line.err{color:var(--red)}
.export-row{padding:10px;display:flex;flex-direction:column;gap:6px;border-top:1px solid #1a0030}
/* Empty */
.empty-preview{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:12px;color:var(--fgd)}
.empty-icon{font-size:3rem}
/* Spinner */
.spinner{display:inline-block;width:12px;height:12px;border:2px solid #3a0066;border-top-color:var(--purple);border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:4px}
@keyframes spin{to{transform:rotate(360deg)}}
.toast{position:fixed;bottom:24px;right:24px;background:var(--bg2);border:1px solid var(--purple);border-radius:8px;padding:10px 18px;font-size:.82rem;z-index:9999;opacity:0;transition:.3s;pointer-events:none}
.toast.show{opacity:1}
.progress-bar{height:3px;background:var(--bg2);border-radius:2px;overflow:hidden;margin:6px 0}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--purple),var(--purple-hot));transition:.4s;width:0}
</style>
<script src="../assets/kaixu-nav.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<header>
  <h1>üìÑ Doc Gen</h1>
  <span>AI-powered documentation generator by kAIxU</span>
  <div style="margin-left:auto;display:flex;gap:8px">
    <button class="btn btn-outline" onclick="clearAll()">‚Ü∫ Clear</button>
    <button class="btn btn-cyan" onclick="generateAll()">‚ö° Generate All</button>
    <button class="btn btn-gold" onclick="exportMd()">‚Üì Export .md</button>
  </div>
</header>

<main>
  <!-- Left panel -->
  <div class="left-panel">
    <div class="section">
      <div class="section-title">Project Info</div>
      <div class="form-group"><label class="form-label">Project Name</label><input class="form-input" id="projName" placeholder="My Awesome App"/></div>
      <div class="form-group"><label class="form-label">Description</label><input class="form-input" id="projDesc" placeholder="What does this project do?"/></div>
      <div class="form-group"><label class="form-label">GitHub Repo URL</label><input class="form-input" id="projRepo" placeholder="https://github.com/user/repo"/></div>
      <div class="form-group"><label class="form-label">Tech Stack (comma-sep)</label><input class="form-input" id="projStack" placeholder="React, Node.js, PostgreSQL"/></div>
    </div>
    <div class="section">
      <div class="section-title">Paste Your Code</div>
      <div class="form-group"><label class="form-label">Source code / routes / functions</label><textarea class="form-input" id="sourceCode" rows="6" placeholder="// Paste your code here&#10;// kAIxU will generate docs from it"></textarea></div>
    </div>
    <div class="section">
      <div class="section-title">Generate</div>
      <div class="gen-btn-row">
        <button class="gen-btn" id="btn-readme" onclick="genReadme()">üìã README.md <span class="badge">Markdown</span></button>
        <button class="gen-btn" id="btn-jsdoc" onclick="genJsDoc()">üîñ JSDoc / PyDoc <span class="badge">Docstrings</span></button>
        <button class="gen-btn" id="btn-openapi" onclick="genOpenAPI()">üîå API Reference <span class="badge">OpenAPI 3.0</span></button>
        <button class="gen-btn" id="btn-changelog" onclick="genChangelog()">üìú Changelog <span class="badge">from git log</span></button>
      </div>
    </div>
    <div class="section">
      <div class="section-title">Options</div>
      <div class="check-row"><input type="checkbox" id="incBadges" checked/><label for="incBadges">Include badges</label></div>
      <div class="check-row"><input type="checkbox" id="incToc" checked/><label for="incToc">Table of contents</label></div>
      <div class="check-row"><input type="checkbox" id="incExamples" checked/><label for="incExamples">Code examples</label></div>
      <div class="check-row"><input type="checkbox" id="incContrib"/><label for="incContrib">Contributing guide</label></div>
    </div>
    <div class="section">
      <div class="section-title">Git Log Paste</div>
      <div class="form-group"><label class="form-label">Paste git log output for changelog</label><textarea class="form-input" id="gitLog" rows="5" placeholder="$ git log --oneline&#10;abc1234 fix: auth bug&#10;def5678 feat: add API..."></textarea></div>
    </div>
  </div>

  <!-- Center pane -->
  <div class="center-pane">
    <div class="tabs">
      <div class="tab active" onclick="switchTab('preview',this)">üëÅ Preview</div>
      <div class="tab" onclick="switchTab('raw',this)">üìù Raw Markdown</div>
      <div class="tab" onclick="switchTab('jsdoc',this)">üîñ Docstrings</div>
      <div class="tab" onclick="switchTab('openapi',this)">üîå OpenAPI</div>
      <div class="tab" onclick="switchTab('changelog',this)">üìú Changelog</div>
    </div>

    <div class="tab-body active" id="tab-preview">
      <div class="preview-area" id="previewPane">
        <div class="empty-preview">
          <div class="empty-icon">üìÑ</div>
          <div>Fill in project details and click a generator</div>
          <button class="btn btn-purple" onclick="generateAll()">‚ö° Generate All Docs</button>
        </div>
      </div>
    </div>

    <div class="tab-body" id="tab-raw">
      <div class="raw-area"><textarea id="rawMd" placeholder="# Markdown will appear here..."></textarea></div>
    </div>

    <div class="tab-body" id="tab-jsdoc">
      <div class="raw-area"><textarea id="rawJsdoc" placeholder="// JSDoc / PyDoc docstrings will appear here..."></textarea></div>
    </div>

    <div class="tab-body" id="tab-openapi">
      <div class="raw-area"><textarea id="rawOpenapi" placeholder="# OpenAPI 3.0 YAML will appear here..."></textarea></div>
    </div>

    <div class="tab-body" id="tab-changelog">
      <div class="raw-area"><textarea id="rawChangelog" placeholder="# CHANGELOG.md will appear here..."></textarea></div>
    </div>
  </div>

  <!-- Right panel (log) -->
  <div class="right-panel">
    <div class="rp-title">Generation Log</div>
    <div class="log-stream" id="logStream">
      <div class="log-line info">Ready. Fill in project details and generate.</div>
    </div>
    <div class="export-row">
      <button class="btn btn-outline" onclick="copyRaw()" style="font-size:.75rem">üìã Copy Current</button>
      <button class="btn btn-outline" onclick="downloadCurrent()" style="font-size:.75rem">‚¨á Download Current</button>
      <button class="btn btn-outline" onclick="downloadCurrentPdf()" style="font-size:.75rem">üìÑ Export PDF</button>
      <button class="btn btn-gold" onclick="exportBundle()" style="font-size:.75rem">üì¶ Export Bundle</button>
      <button class="btn btn-outline" onclick="openNotion()" style="font-size:.75rem">üîó Notion</button>
    </div>
  </div>
</main>

<div class="toast" id="toast"></div>

<script>
const WORKER=(window.KAIXU_WORKER||'https://kaixusi'+'.skyesoverlondon.workers.dev');
function getToken(){try{return JSON.parse(localStorage.getItem('sovereign_brain_cfg')||'{}').token||'';}catch(e){return '';}}
function toast(m,c='var(--purple)'){const t=document.getElementById('toast');t.textContent=m;t.style.borderColor=c;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800)}

let docs={readme:'',jsdoc:'',openapi:'',changelog:''};

function log(msg,type='info'){
  const el=document.getElementById('logStream');
  const div=document.createElement('div');
  div.className=`log-line ${type}`;
  div.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;
  el.appendChild(div);
  el.scrollTop=el.scrollHeight;
}

function switchTab(tab,el){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-body').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(`tab-${tab}`).classList.add('active');
}

function projContext(){
  return{
    name:document.getElementById('projName').value||'My Project',
    desc:document.getElementById('projDesc').value||'A modern software project',
    repo:document.getElementById('projRepo').value,
    stack:document.getElementById('projStack').value||'JavaScript',
    code:document.getElementById('sourceCode').value,
    badges:document.getElementById('incBadges').checked,
    toc:document.getElementById('incToc').checked,
    examples:document.getElementById('incExamples').checked,
    contrib:document.getElementById('incContrib').checked,
  };
}

async function callAI(prompt){
  const r=await fetch(`${WORKER}/v1/chat`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${getToken()}`},
    body:JSON.stringify({messages:[{role:'user',content:prompt}],max_tokens:1800,app_id:'kaixu-docgen'})});
  if(!r.ok) throw new Error(`HTTP ${r.status}`);
  const d=await r.json();
  return d.choices?.[0]?.message?.content||d.content||'';
}

function setBtn(id,loading){
  const btn=document.getElementById(`btn-${id}`);
  if(!btn) return;
  btn.classList.toggle('running',loading);
}

async function genReadme(){
  const p=projContext();
  setBtn('readme',true);
  log('Generating README.md...','info');
  try{
    const badges=p.badges?`![License](https://img.shields.io/badge/license-MIT-blue) ![Version](https://img.shields.io/badge/version-1.0.0-purple)`:'';
    const prompt=`Generate a professional, well-structured README.md for this project.
Project: ${p.name}
Description: ${p.desc}
Tech Stack: ${p.stack}
Repo: ${p.repo||'(local)'}
${p.code?`Source code snippet:\n\`\`\`\n${p.code.slice(0,1500)}\n\`\`\``:''}
Requirements:
${p.toc?'- Include a table of contents':''}
${p.examples?'- Include code examples for installation and usage':''}
${p.contrib?'- Include a Contributing section':''}
${p.badges?'- Include badge placeholders at the top':''}
Use markdown formatting. Make it detailed and professional.`;
    const md=await callAI(prompt);
    docs.readme=md;
    document.getElementById('rawMd').value=md;
    renderMarkdown(md);
    log('README.md generated ‚úì','ok');
    toast('README generated ‚úì','var(--green)');
  }catch(e){log('README failed: '+e.message,'err');toast('Failed: '+e.message,'var(--red)');}
  setBtn('readme',false);
}

async function genJsDoc(){
  const p=projContext();
  if(!p.code){toast('Paste source code first','var(--orange)');return;}
  setBtn('jsdoc',true);
  log('Generating JSDoc/PyDoc...','info');
  try{
    const isP=p.code.includes('def ');
    const prompt=`Add ${isP?'PyDoc':'JSDoc'} docstrings to every function in this code. Return the complete code with docstrings added. Do not add explanations outside the code.\n\`\`\`\n${p.code}\n\`\`\``;
    const r=await callAI(prompt);
    docs.jsdoc=r;
    document.getElementById('rawJsdoc').value=r;
    switchTab('jsdoc',document.querySelectorAll('.tab')[2]);
    log('Docstrings generated ‚úì','ok');
    toast('Docstrings generated ‚úì','var(--green)');
  }catch(e){log('JSDoc failed: '+e.message,'err');toast('Failed: '+e.message,'var(--red)');}
  setBtn('jsdoc',false);
}

async function genOpenAPI(){
  const p=projContext();
  setBtn('openapi',true);
  log('Generating OpenAPI 3.0 spec...','info');
  try{
    const prompt=`Generate a complete OpenAPI 3.0 YAML specification for this project.
Project: ${p.name}
Description: ${p.desc}
Stack: ${p.stack}
${p.code?`Route/code hints:\n\`\`\`\n${p.code.slice(0,1500)}\n\`\`\``:'Infer typical REST endpoints from the project description.'}
Return only valid OpenAPI 3.0 YAML, no explanation.`;
    const r=await callAI(prompt);
    docs.openapi=r.replace(/```ya?ml\n?/g,'').replace(/```/g,'').trim();
    document.getElementById('rawOpenapi').value=docs.openapi;
    switchTab('openapi',document.querySelectorAll('.tab')[3]);
    log('OpenAPI spec generated ‚úì','ok');
    toast('OpenAPI spec generated ‚úì','var(--green)');
  }catch(e){log('OpenAPI failed: '+e.message,'err');toast('Failed: '+e.message,'var(--red)');}
  setBtn('openapi',false);
}

async function genChangelog(){
  const gl=document.getElementById('gitLog').value;
  setBtn('changelog',true);
  log('Generating CHANGELOG.md...','info');
  try{
    const p=projContext();
    const prompt=`Generate a professional CHANGELOG.md${gl?` from this git log:\n${gl}`:`for a project called "${p.name}" ‚Äî infer reasonable version history`}.
Group commits into: [Added], [Fixed], [Changed], [Removed]. Use Keep a Changelog format. Return only markdown.`;
    const r=await callAI(prompt);
    docs.changelog=r;
    document.getElementById('rawChangelog').value=r;
    switchTab('changelog',document.querySelectorAll('.tab')[4]);
    log('Changelog generated ‚úì','ok');
    toast('Changelog generated ‚úì','var(--green)');
  }catch(e){log('Changelog failed: '+e.message,'err');toast('Failed: '+e.message,'var(--red)');}
  setBtn('changelog',false);
}

async function generateAll(){
  log('Starting full doc generation...','info');
  await genReadme();
  const p=projContext();
  if(p.code) await genJsDoc();
  await genOpenAPI();
  await genChangelog();
  log('All docs generated ‚úì','ok');
  toast('All docs generated ‚úì','var(--green)');
}

function renderMarkdown(md){
  const pane=document.getElementById('previewPane');
  let html=md
    .replace(/^#{4}\s(.+)$/gm,'<h4>$1</h4>')
    .replace(/^#{3}\s(.+)$/gm,'<h3>$1</h3>')
    .replace(/^#{2}\s(.+)$/gm,'<h2>$1</h2>')
    .replace(/^#{1}\s(.+)$/gm,'<h1>$1</h1>')
    .replace(/```[\w]*\n([\s\S]*?)```/g,'<pre><code>$1</code></pre>')
    .replace(/`([^`]+)`/g,'<code>$1</code>')
    .replace(/\*\*([^*]+)\*\*/g,'<strong>$1</strong>')
    .replace(/\*([^*]+)\*/g,'<em>$1</em>')
    .replace(/^\-\s(.+)$/gm,'<li>$1</li>')
    .replace(/\n\n/g,'<br/><br/>')
    .replace(/(<li>.*<\/li>)/gs,'<ul>$1</ul>');
  pane.innerHTML=html||'<div style="color:var(--fgd)">Preview empty</div>';
  switchTab('preview',document.querySelectorAll('.tab')[0]);
}

function clearAll(){
  docs={readme:'',jsdoc:'',openapi:'',changelog:''};
  ['rawMd','rawJsdoc','rawOpenapi','rawChangelog'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('previewPane').innerHTML=`<div class="empty-preview"><div class="empty-icon">üìÑ</div><div>Fill in project details and click a generator</div><button class="btn btn-purple" onclick="generateAll()">‚ö° Generate All Docs</button></div>`;
  log('Cleared','warn');
}

function copyRaw(){
  const active=document.querySelector('.tab-body.active textarea');
  if(!active||!active.value){toast('Nothing to copy','var(--orange)');return;}
  navigator.clipboard.writeText(active.value).then(()=>toast('Copied ‚úì','var(--green)'));
}

function downloadCurrent(){
  const active=document.querySelector('.tab-body.active textarea');
  if(!active||!active.value){toast('Nothing to download','var(--orange)');return;}
  const tabMap={rawMd:'README.md',rawJsDoc:'DOCSTRINGS.txt',rawOpenapi:'openapi.yaml',rawChangelog:'CHANGELOG.md'};
  const filename=tabMap[active.id]||'kaixu-doc.txt';
  const ext=filename.split('.').pop();
  const mimeMap={md:'text/markdown',yaml:'text/yaml',txt:'text/plain',json:'application/json'};
  const mime=mimeMap[ext]||'text/plain';
  const blob=new Blob([active.value],{type:mime});
  const a=Object.assign(document.createElement('a'),{href:URL.createObjectURL(blob),download:filename});
  a.click(); URL.revokeObjectURL(a.href);
  toast(`${filename} downloaded ‚úì`,'var(--green)');
}

function exportMd(){
  const md=docs.readme||document.getElementById('rawMd').value;
  if(!md){toast('Generate README first','var(--orange)');return;}
  const blob=new Blob([md],{type:'text/markdown'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='README.md';
  a.click();
  toast('README.md downloaded ‚úì','var(--green)');
}

function exportBundle(){
  const parts=[];
  if(docs.readme) parts.push({name:'README.md',content:docs.readme});
  if(docs.jsdoc) parts.push({name:'DOCSTRINGS.txt',content:docs.jsdoc});
  if(docs.openapi) parts.push({name:'openapi.yaml',content:docs.openapi});
  if(docs.changelog) parts.push({name:'CHANGELOG.md',content:docs.changelog});
  if(!parts.length){toast('Generate some docs first','var(--orange)');return;}
  parts.forEach(f=>{
    const blob=new Blob([f.content],{type:'text/plain'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download=f.name;
    a.click();
  });
  toast(`Exported ${parts.length} files ‚úì`,'var(--gold)');
}

function openNotion(){toast('Notion export coming in v2','var(--orange)');}

function downloadCurrentPdf(){
  const active=document.querySelector('.tab-body.active textarea');
  if(!active||!active.value){toast('Nothing to export','var(--orange)');return;}
  if(!window.jspdf){toast('PDF library loading ‚Äî try again','var(--orange)');return;}
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'pt', format:'a4' });
  const margin = 40, pageW = doc.internal.pageSize.getWidth() - margin*2;
  const lines = active.value.split('\n');
  let y = 60;
  // Header
  doc.setFillColor(20,0,40);
  doc.rect(0,0,doc.internal.pageSize.getWidth(),40,'F');
  doc.setTextColor(187,49,255);
  doc.setFontSize(14);
  doc.setFont('helvetica','bold');
  doc.text('kAIxU DocGen Export',margin,26);
  doc.setTextColor(180,180,180);
  doc.setFontSize(8);
  doc.text(new Date().toLocaleString(),doc.internal.pageSize.getWidth()-margin,26,{align:'right'});
  // Content
  doc.setTextColor(30,30,30);
  lines.forEach(line=>{
    let fontSize=10, isBold=false;
    if(line.startsWith('# ')){ fontSize=16; isBold=true; line=line.slice(2); }
    else if(line.startsWith('## ')){ fontSize=13; isBold=true; line=line.slice(3); }
    else if(line.startsWith('### ')){ fontSize=11; isBold=true; line=line.slice(4); }
    doc.setFontSize(fontSize);
    doc.setFont('helvetica', isBold?'bold':'normal');
    const wrapped=doc.splitTextToSize(line||' ',pageW);
    const lineH=fontSize+4;
    if(y+wrapped.length*lineH>doc.internal.pageSize.getHeight()-margin){
      doc.addPage();
      y=margin;
    }
    doc.text(wrapped,margin,y);
    y+=wrapped.length*lineH+(isBold?6:2);
  });
  const tabMap={rawMd:'README',rawJsDoc:'DOCSTRINGS',rawOpenapi:'OpenAPI',rawChangelog:'CHANGELOG'};
  const name=tabMap[active.id]||'kaixu-doc';
  doc.save(`${name}.pdf`);
  toast(`${name}.pdf downloaded ‚úì`,'var(--green)');
}
</script>
</body>
</html>
